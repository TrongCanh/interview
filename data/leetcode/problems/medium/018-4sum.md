# 4Sum / 4Sum

> LeetCode Problem 18 & Difficulty: Medium

---

## ğŸ“Œ ThÃ´ng tin BÃ i toÃ¡n / Problem Information

- **Problem ID:** 18
- **URL:** https://leetcode.com/problems/4sum/
- **Äá»™ khÃ³ / Difficulty:** Medium
- **Danh má»¥c / Category:** Array
- **Tags:** Array, Two Pointers, Sorting
- **Thuáº­t toÃ¡n liÃªn quan / Related Algorithms:** Two Pointers, Sorting
- **Patterns liÃªn quan / Related Patterns:** Two Pointers

---

## ğŸ“„ Äá» BÃ i NguyÃªn Báº£n / Original Problem

> Copy nguyÃªn vÄƒn tá»« LeetCode

Given an array `nums` of `n` integers, return an array of all the unique quadruplets `[nums[a], nums[b], nums[c], nums[d]]` such that:

- `0 <= a, b, c, d < n`
- `a`, `b`, `c`, and `d` are distinct.
- `nums[a] + nums[b] + nums[c] + nums[d] == target`

You may return the answer in any order.

**Example 1:**

```
Input: nums = [1,0,-1,0,-2,2], target = 0
Output: [[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]
```

**Example 2:**

```
Input: nums = [2,2,2,2,2], target = 8
Output: [[2,2,2,2]]
```

**Constraints:**

- `1 <= nums.length <= 200`
- `-10^9 <= nums[i] <= 10^9`
- `-10^9 <= target <= 10^9`

---

## ğŸ§  PhÃ¢n tÃ­ch Äá» BÃ i / Problem Analysis

### 1. Hiá»ƒu Ä‘á» bÃ i / Understanding the Problem

- **Input:** Máº£ng sá»‘ nguyÃªn `nums` vÃ  sá»‘ nguyÃªn `target`
- **Output:** Máº£ng cÃ¡c quadruplet duy nháº¥t cÃ³ tá»•ng báº±ng `target`
- **RÃ ng buá»™c / Constraints:**
  - Äá»™ dÃ i máº£ng: 1 Ä‘áº¿n 200
  - GiÃ¡ trá»‹ pháº§n tá»­: -10^9 Ä‘áº¿n 10^9
  - GiÃ¡ trá»‹ target: -10^9 Ä‘áº¿n 10^9
- **Edge cases:**
  - Máº£ng cÃ³ Ã­t hÆ¡n 4 pháº§n tá»­
  - Máº£ng cÃ³ nhiá»u pháº§n tá»­ giá»‘ng nhau
  - Target ráº¥t lá»›n hoáº·c ráº¥t nhá»
  - KhÃ´ng cÃ³ quadruplet nÃ o thá»a mÃ£n

### 2. TÆ° duy / Thinking Process

- BÆ°á»›c 1: Hiá»ƒu yÃªu cáº§u - tÃ¬m táº¥t cáº£ cÃ¡c bá»™ 4 sá»‘ cÃ³ tá»•ng báº±ng target, khÃ´ng trÃ¹ng láº·p
- BÆ°á»›c 2: Nháº­n tháº¥y tÆ°Æ¡ng tá»± bÃ i 3Sum nhÆ°ng vá»›i 4 sá»‘ thay vÃ¬ 3
- BÆ°á»›c 3: CÃ³ thá»ƒ Ã¡p dá»¥ng pattern Two Pointers sau khi sort máº£ng

### 3. VÃ­ dá»¥ minh há»a / Examples

```
Example 1:
Input: nums = [1,0,-1,0,-2,2], target = 0
Output: [[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]
Explanation: Sau khi sort: [-2,-1,0,0,1,2]
- -2 + -1 + 1 + 2 = 0
- -2 + 0 + 0 + 2 = 0
- -1 + 0 + 0 + 1 = 0

Example 2:
Input: nums = [2,2,2,2,2], target = 8
Output: [[2,2,2,2]]
Explanation: Táº¥t cáº£ 5 pháº§n tá»­ Ä‘á»u lÃ  2, chá»‰ cÃ³ 1 cÃ¡ch chá»n 4 sá»‘
```

---

## ğŸ’¡ Giáº£i phÃ¡p 1: Brute Force (CÆ¡ báº£n nháº¥t) / Basic Solution

### Ã tÆ°á»Ÿng / Idea

DÃ¹ng 4 vÃ²ng láº·p lá»“ng nhau Ä‘á»ƒ thá»­ táº¥t cáº£ cÃ¡c tá»• há»£p 4 sá»‘ khÃ¡c nhau, kiá»ƒm tra tá»•ng vÃ  loáº¡i bá» trÃ¹ng láº·p.

### Thuáº­t toÃ¡n / Algorithm

1. Khá»Ÿi táº¡o máº£ng result Ä‘á»ƒ lÆ°u káº¿t quáº£
2. DÃ¹ng 4 vÃ²ng láº·p lá»“ng nhau vá»›i cÃ¡c index i, j, k, l
3. Vá»›i má»—i tá»• há»£p, kiá»ƒm tra tá»•ng cÃ³ báº±ng target khÃ´ng
4. Náº¿u báº±ng, thÃªm vÃ o result (sau khi kiá»ƒm tra trÃ¹ng láº·p)
5. Tráº£ vá» result

### Code / Implementation

```javascript
/**
 * 4Sum - Brute Force Solution
 * @param {number[]} nums - Máº£ng sá»‘ nguyÃªn Ä‘áº§u vÃ o
 * @param {number} target - Tá»•ng má»¥c tiÃªu
 * @return {number[][]} - Máº£ng cÃ¡c quadruplet cÃ³ tá»•ng báº±ng target
 */
function fourSum_bruteForce(nums, target) {
  const result = [];
  const n = nums.length;

  // Cáº§n Ã­t nháº¥t 4 pháº§n tá»­
  if (n < 4) return result;

  for (let i = 0; i < n - 3; i++) {
    for (let j = i + 1; j < n - 2; j++) {
      for (let k = j + 1; k < n - 1; k++) {
        for (let l = k + 1; l < n; l++) {
          const sum = nums[i] + nums[j] + nums[k] + nums[l];
          if (sum === target) {
            const quad = [nums[i], nums[j], nums[k], nums[l]].sort(
              (a, b) => a - b,
            );
            // Kiá»ƒm tra trÃ¹ng láº·p
            const isDuplicate = result.some(
              (r) =>
                r[0] === quad[0] &&
                r[1] === quad[1] &&
                r[2] === quad[2] &&
                r[3] === quad[3],
            );
            if (!isDuplicate) {
              result.push(quad);
            }
          }
        }
      }
    }
  }

  return result;
}
```

### Äá»™ phá»©c táº¡p / Complexity

- **Time Complexity:** O(nâ´) - 4 vÃ²ng láº·p lá»“ng nhau
- **Space Complexity:** O(k) - k lÃ  sá»‘ lÆ°á»£ng quadruplet tÃ¬m Ä‘Æ°á»£c

### Æ¯u Ä‘iá»ƒm / Pros

- Dá»… hiá»ƒu vÃ  implement
- Äáº£m báº£o tÃ¬m Ä‘Æ°á»£c táº¥t cáº£ cÃ¡c giáº£i phÃ¡p

### NhÆ°á»£c Ä‘iá»ƒm / Cons

- Äá»™ phá»©c táº¡p thá»i gian ráº¥t cao
- KhÃ´ng hiá»‡u quáº£ vá»›i máº£ng lá»›n
- Tá»‘n thá»i gian kiá»ƒm tra trÃ¹ng láº·p

---

## ğŸš€ Giáº£i phÃ¡p 2: Optimized (Cáº£i tiáº¿n) / Optimized Solution

### PhÃ¢n tÃ­ch cáº£i tiáº¿n / Improvement Analysis

- Táº¡i sao cáº§n cáº£i tiáº¿n? O(nâ´) quÃ¡ cháº­m vá»›i n lÃªn Ä‘áº¿n 200
- Äiá»ƒm yáº¿u cá»§a giáº£i phÃ¡p 1? Thá»­ quÃ¡ nhiá»u tá»• há»£p khÃ´ng cáº§n thiáº¿t
- CÃ¡ch tiáº¿p cáº­n má»›i? Sort máº£ng vÃ  dÃ¹ng Two Pointers pattern

### Ã tÆ°á»Ÿng / Idea

Sort máº£ng trÆ°á»›c, sau Ä‘Ã³ dÃ¹ng 2 vÃ²ng láº·p Ä‘á»ƒ chá»n 2 sá»‘ Ä‘áº§u tiÃªn, vÃ  Two Pointers Ä‘á»ƒ tÃ¬m 2 sá»‘ cÃ²n láº¡i. CÃ¡ch nÃ y giÃºp giáº£m Ä‘á»™ phá»©c táº¡p xuá»‘ng O(nÂ³) vÃ  dá»… dÃ ng trÃ¡nh trÃ¹ng láº·p.

### Thuáº­t toÃ¡n / Algorithm

1. Sort máº£ng nums
2. Khá»Ÿi táº¡o result
3. DÃ¹ng vÃ²ng láº·p i tá»« 0 Ä‘áº¿n n-4
4. DÃ¹ng vÃ²ng láº·p j tá»« i+1 Ä‘áº¿n n-3
5. Sá»­ dá»¥ng two pointers: left = j+1, right = n-1
6. TÃ­nh tá»•ng cá»§a 4 sá»‘
7. Náº¿u tá»•ng < target: tÄƒng left
8. Náº¿u tá»•ng > target: giáº£m right
9. Náº¿u tá»•ng == target: thÃªm vÃ o result, tÄƒng left vÃ  giáº£m right
10. TrÃ¡nh trÃ¹ng láº·p báº±ng cÃ¡ch bá» qua cÃ¡c pháº§n tá»­ giá»‘ng nhau

### Code / Implementation

```javascript
/**
 * 4Sum - Optimized Solution using Two Pointers
 * @param {number[]} nums - Máº£ng sá»‘ nguyÃªn Ä‘áº§u vÃ o
 * @param {number} target - Tá»•ng má»¥c tiÃªu
 * @return {number[][]} - Máº£ng cÃ¡c quadruplet cÃ³ tá»•ng báº±ng target
 */
function fourSum_optimized(nums, target) {
  const result = [];
  const n = nums.length;

  // Cáº§n Ã­t nháº¥t 4 pháº§n tá»­
  if (n < 4) return result;

  // Sort máº£ng Ä‘á»ƒ Ã¡p dá»¥ng two pointers
  nums.sort((a, b) => a - b);

  for (let i = 0; i < n - 3; i++) {
    // Bá» qua cÃ¡c pháº§n tá»­ trÃ¹ng láº·p cho i
    if (i > 0 && nums[i] === nums[i - 1]) continue;

    // Early termination: náº¿u tá»•ng nhá» nháº¥t tá»« i > target, dá»«ng
    if (nums[i] + nums[i + 1] + nums[i + 2] + nums[i + 3] > target) break;

    // Early termination: náº¿u tá»•ng lá»›n nháº¥t tá»« i < target, tiáº¿p tá»¥c
    if (nums[i] + nums[n - 3] + nums[n - 2] + nums[n - 1] < target) continue;

    for (let j = i + 1; j < n - 2; j++) {
      // Bá» qua cÃ¡c pháº§n tá»­ trÃ¹ng láº·p cho j
      if (j > i + 1 && nums[j] === nums[j - 1]) continue;

      // Early termination cho j
      if (nums[i] + nums[j] + nums[j + 1] + nums[j + 2] > target) break;
      if (nums[i] + nums[j] + nums[n - 2] + nums[n - 1] < target) continue;

      // Two pointers
      let left = j + 1;
      let right = n - 1;

      while (left < right) {
        const sum = nums[i] + nums[j] + nums[left] + nums[right];

        if (sum === target) {
          result.push([nums[i], nums[j], nums[left], nums[right]]);

          // Bá» qua trÃ¹ng láº·p cho left
          while (left < right && nums[left] === nums[left + 1]) left++;
          // Bá» qua trÃ¹ng láº·p cho right
          while (left < right && nums[right] === nums[right - 1]) right--;

          left++;
          right--;
        } else if (sum < target) {
          left++;
        } else {
          right--;
        }
      }
    }
  }

  return result;
}
```

### Äá»™ phá»©c táº¡p / Complexity

- **Time Complexity:** O(nÂ³) - 2 vÃ²ng láº·p + two pointers
- **Space Complexity:** O(1) - khÃ´ng dÃ¹ng thÃªm bá»™ nhá»› Ä‘Ã¡ng ká»ƒ (ngoÃ i result)

### Æ¯u Ä‘iá»ƒm / Pros

- Äá»™ phá»©c táº¡p thá»i gian tá»‘t hÆ¡n nhiá»u so vá»›i brute force
- Dá»… dÃ ng trÃ¡nh trÃ¹ng láº·p nhá» Ä‘Ã£ sort
- CÃ³ thá»ƒ Ã¡p dá»¥ng early termination Ä‘á»ƒ tá»‘i Æ°u thÃªm

### NhÆ°á»£c Ä‘iá»ƒm / Cons

- Cáº§n sort máº£ng (O(n log n))
- Phá»©c táº¡p hÆ¡n brute force

---

## âš¡ Giáº£i phÃ¡p 3: Advanced (NÃ¢ng cao) / Advanced Solution

### PhÃ¢n tÃ­ch nÃ¢ng cao / Advanced Analysis

- CÃ³ thá»ƒ cáº£i thiá»‡n thÃªm khÃ´ng? CÃ³ thá»ƒ dÃ¹ng HashMap Ä‘á»ƒ lÆ°u cÃ¡c cáº·p sá»‘
- CÃ³ thuáº­t toÃ¡n/pattern nÃ o phÃ¹ há»£p hÆ¡n? Hash Map pattern

### Ã tÆ°á»Ÿng / Idea

Sá»­ dá»¥ng HashMap Ä‘á»ƒ lÆ°u táº¥t cáº£ cÃ¡c cáº·p sá»‘ vÃ  tá»•ng cá»§a chÃºng. Sau Ä‘Ã³, vá»›i má»—i cáº·p sá»‘, tÃ¬m cáº·p sá»‘ cÃ²n láº¡i trong HashMap sao cho tá»•ng báº±ng target. CÃ¡ch nÃ y cÃ³ Ä‘á»™ phá»©c táº¡p O(nÂ²) nhÆ°ng tá»‘n nhiá»u bá»™ nhá»›.

### Thuáº­t toÃ¡n / Algorithm

1. Táº¡o HashMap: key = tá»•ng cá»§a cáº·p sá»‘, value = máº£ng cÃ¡c cáº·p sá»‘
2. Duyá»‡t qua táº¥t cáº£ cÃ¡c cáº·p sá»‘ (i, j) vá»›i i < j
3. Vá»›i má»—i cáº·p, tÃ­nh sum vÃ  lÆ°u vÃ o HashMap
4. Duyá»‡t láº¡i qua táº¥t cáº£ cÃ¡c cáº·p sá»‘
5. Vá»›i má»—i cáº·p, tÃ¬m complement = target - sum trong HashMap
6. Náº¿u tÃ¬m tháº¥y, káº¿t há»£p cÃ¡c cáº·p sá»‘ Ä‘á»ƒ táº¡o quadruplet
7. Loáº¡i bá» trÃ¹ng láº·p

### Code / Implementation

```javascript
/**
 * 4Sum - Advanced Solution using HashMap
 * @param {number[]} nums - Máº£ng sá»‘ nguyÃªn Ä‘áº§u vÃ o
 * @param {number} target - Tá»•ng má»¥c tiÃªu
 * @return {number[][]} - Máº£ng cÃ¡c quadruplet cÃ³ tá»•ng báº±ng target
 */
function fourSum_advanced(nums, target) {
  const result = [];
  const n = nums.length;

  if (n < 4) return result;

  // Sort Ä‘á»ƒ dá»… dÃ ng loáº¡i bá» trÃ¹ng láº·p
  nums.sort((a, b) => a - b);

  // HashMap: key = tá»•ng cá»§a cáº·p sá»‘, value = máº£ng cÃ¡c cáº·p [i, j]
  const pairSumMap = new Map();

  // LÆ°u táº¥t cáº£ cÃ¡c cáº·p sá»‘
  for (let i = 0; i < n - 1; i++) {
    for (let j = i + 1; j < n; j++) {
      const sum = nums[i] + nums[j];
      if (!pairSumMap.has(sum)) {
        pairSumMap.set(sum, []);
      }
      pairSumMap.get(sum).push([i, j]);
    }
  }

  const seen = new Set();

  // TÃ¬m cÃ¡c cáº·p sá»‘ cÃ³ tá»•ng báº±ng target
  for (const [sum1, pairs1] of pairSumMap) {
    const sum2 = target - sum1;

    if (pairSumMap.has(sum2)) {
      const pairs2 = pairSumMap.get(sum2);

      for (const [i1, j1] of pairs1) {
        for (const [i2, j2] of pairs2) {
          // Kiá»ƒm tra 4 index khÃ¡c nhau
          if (i1 !== i2 && i1 !== j2 && j1 !== i2 && j1 !== j2) {
            const quad = [nums[i1], nums[j1], nums[i2], nums[j2]].sort(
              (a, b) => a - b,
            );
            const key = quad.join(",");

            if (!seen.has(key)) {
              seen.add(key);
              result.push(quad);
            }
          }
        }
      }
    }
  }

  return result;
}
```

### Äá»™ phá»©c táº¡p / Complexity

- **Time Complexity:** O(nÂ²) - nhÆ°ng vá»›i constant factor lá»›n
- **Space Complexity:** O(nÂ²) - Ä‘á»ƒ lÆ°u HashMap

### Æ¯u Ä‘iá»ƒm / Pros

- Äá»™ phá»©c táº¡p thá»i gian lÃ½ thuyáº¿t tá»‘t hÆ¡n
- KhÃ´ng cáº§n sort (trá»« khi Ä‘á»ƒ loáº¡i bá» trÃ¹ng láº·p)

### NhÆ°á»£c Ä‘iá»ƒm / Cons

- Tá»‘n ráº¥t nhiá»u bá»™ nhá»›
- Constant factor lá»›n khiáº¿n thá»±c táº¿ cÃ³ thá»ƒ cháº­m hÆ¡n
- Phá»©c táº¡p Ä‘á»ƒ implement Ä‘Ãºng

---

## ğŸ“Š So sÃ¡nh CÃ¡c Giáº£i phÃ¡p / Solution Comparison

| Giáº£i phÃ¡p / Solution | Time  | Space | Äá»™ khÃ³ / Difficulty | Khi nÃ o dÃ¹ng / When to use |
| -------------------- | ----- | ----- | ------------------- | -------------------------- |
| Brute Force          | O(nâ´) | O(k)  | Dá»… / Easy           | Máº£ng ráº¥t nhá» (< 10)        |
| Optimized            | O(nÂ³) | O(1)  | Trung bÃ¬nh / Medium | Máº£ng trung bÃ¬nh (< 200)    |
| Advanced             | O(nÂ²) | O(nÂ²) | KhÃ³ / Hard          | Máº£ng lá»›n, bá»™ nhá»› dÆ° thá»«a   |

---

## ğŸ§ª Test Cases

### Test Case 1: CÆ¡ báº£n / Basic

```javascript
const nums1 = [1, 0, -1, 0, -2, 2];
const target1 = 0;
console.log(fourSum_bruteForce(nums1, target1)); // Expected: [[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]
console.log(fourSum_optimized(nums1, target1)); // Expected: [[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]
console.log(fourSum_advanced(nums1, target1)); // Expected: [[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]
```

### Test Case 2: Edge case - Táº¥t cáº£ pháº§n tá»­ giá»‘ng nhau

```javascript
const nums2 = [2, 2, 2, 2, 2];
const target2 = 8;
console.log(fourSum_bruteForce(nums2, target2)); // Expected: [[2,2,2,2]]
console.log(fourSum_optimized(nums2, target2)); // Expected: [[2,2,2,2]]
console.log(fourSum_advanced(nums2, target2)); // Expected: [[2,2,2,2]]
```

### Test Case 3: Edge case - KhÃ´ng cÃ³ káº¿t quáº£

```javascript
const nums3 = [1, 2, 3, 4];
const target3 = 100;
console.log(fourSum_bruteForce(nums3, target3)); // Expected: []
console.log(fourSum_optimized(nums3, target3)); // Expected: []
console.log(fourSum_advanced(nums3, target3)); // Expected: []
```

### Test Case 4: Máº£ng nhá» nháº¥t

```javascript
const nums4 = [1, 2, 3, 4];
const target4 = 10;
console.log(fourSum_bruteForce(nums4, target4)); // Expected: [[1,2,3,4]]
console.log(fourSum_optimized(nums4, target4)); // Expected: [[1,2,3,4]]
console.log(fourSum_advanced(nums4, target4)); // Expected: [[1,2,3,4]]
```

### Test Case 5: Target Ã¢m

```javascript
const nums5 = [-3, -2, -1, 0, 0, 1, 2, 3];
const target5 = 0;
console.log(fourSum_bruteForce(nums5, target5)); // Expected: [[-3,-2,2,3],[-3,-1,1,3],[-3,0,0,3],[-3,0,1,2],[-2,-1,1,2],[-2,0,0,2],[-2,0,1,1],[-1,0,0,1]]
console.log(fourSum_optimized(nums5, target5)); // Expected: [[-3,-2,2,3],[-3,-1,1,3],[-3,0,0,3],[-3,0,1,2],[-2,-1,1,2],[-2,0,0,2],[-2,0,1,1],[-1,0,0,1]]
console.log(fourSum_advanced(nums5, target5)); // Expected: [[-3,-2,2,3],[-3,-1,1,3],[-3,0,0,3],[-3,0,1,2],[-2,-1,1,2],[-2,0,0,2],[-2,0,1,1],[-1,0,0,1]]
```

---

## ğŸ”— LiÃªn káº¿t Thuáº­t toÃ¡n / Algorithm Links

- **Thuáº­t toÃ¡n liÃªn quan:**
  - [Sorting](../algorithms/algorithms/sorting.md)
  - [Two Pointers](../algorithms/patterns/two-pointers.md)
  - [Array](../algorithms/data-structures/array.md)

- **Patterns liÃªn quan:**
  - [Two Pointers](../algorithms/patterns/two-pointers.md)

---

## ğŸ“š TÃ i liá»‡u tham kháº£o / References

- [LeetCode 4Sum](https://leetcode.com/problems/4sum/)
- [LeetCode Discuss](https://leetcode.com/problems/4sum/discuss/)
- [Two Pointers Pattern](../algorithms/patterns/two-pointers.md)

---

## ğŸ’¬ Lá»i khuyÃªn / Tips

- LuÃ´n sort máº£ng trÆ°á»›c khi Ã¡p dá»¥ng two pointers
- Sá»­ dá»¥ng early termination Ä‘á»ƒ tá»‘i Æ°u hiá»‡u nÄƒng
- Bá» qua cÃ¡c pháº§n tá»­ trÃ¹ng láº·p ngay khi phÃ¡t hiá»‡n
- LÆ°u Ã½ vá» overflow khi cá»™ng cÃ¡c sá»‘ lá»›n (trong cÃ¡c ngÃ´n ngá»¯ cÃ³ giá»›i háº¡n integer)
- BÃ i toÃ¡n nÃ y lÃ  má»Ÿ rá»™ng cá»§a 3Sum, cÃ³ thá»ƒ Ã¡p dá»¥ng pattern tÆ°Æ¡ng tá»±

---

_Last updated: 2026-02-03_
